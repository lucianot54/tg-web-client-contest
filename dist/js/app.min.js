var TGApp=function(e){"use strict";var i,n=function(e){var i=document.createElement("div");return i.innerHTML=e,i.firstChild},t=function(e){var i={};return e.querySelectorAll("[ref]").forEach((function(e){i[e.getAttribute("ref")]=e})),i},s=function(e,i,n){e.addEventListener(i,n)},o=[],a=function(){o.forEach((function(e){e()}))};s(window,"resize",(function(){i&&clearTimeout(i),i=setTimeout(a,100)}));var l=[],d=function(e,i){l.push({type:e,handler:i}),s(window,e,i)},r=function(){var e={};return e.promise=new Promise((function(i,n){e.resolve=i,e.reject=n})),e},c=function(e){var i=new Date(1e3*e),n=i.getHours();n<10&&(n="0"+n);var t=i.getMinutes();return t<10&&(t="0"+t),"".concat(n,":").concat(t)};function u(e,i){var t=[];(i=i||{}).isBlue&&t.push("loader__blue"),i.isBig&&t.push("loader__big");var s='<svg class="loader '.concat(t.length?t.join(" "):"",'" viewBox="25 25 50 50"><circle cx=50 cy=50 r=20 stroke-miterlimit=10></circle></svg>'),o=n(s);return e.appendChild(o),{destroy:function(){var i=r();return o.classList.add("loader__hide"),setTimeout((function(){e.removeChild(o),i.resolve()}),300),i.promise}}}function p(e,i){var o=n("<div class=side_header><div class=side_menu ref=menu></div><div class=side_search ref=search></div></div>"),a=t(o);return function(e,i){var o=[];i.isBig&&o.push("button__big"),i.isBlock&&o.push("button__block"),i.isCircle&&o.push("button__circle"),i.isMiddle&&o.push("button__middle"),i.isWhite&&o.push("button__white"),i.isHidden&&o.push("is-hidden");var a,l='<button class="button '.concat(o.length?o.join(" "):"",'"><span ref=text>').concat(i.text,"</span></button>"),d=n(l),r=t(d),c=!1;s(d,"click",(function(e){if(!c){var n=d.getBoundingClientRect(),t=e.x-n.x,s=e.y-n.y,o=document.createElement("div");o.classList.add("button_wave"),o.style.top=s+"px",o.style.left=t+"px",i.isCircle&&(o.style.animationDuration="0.3s"),d.appendChild(o),a&&a.classList.add("button_wave__hide"),a=o;var l=d.offsetWidth/2,r=(Math.abs(l-t)+l)/d.offsetWidth;setTimeout((function(){o.classList.add("button_wave__hide"),setTimeout((function(){d.removeChild(o)}),330)}),Math.ceil((i.isCircle?300:600)*r)),i.onClick()}})),e.appendChild(d);var u,p=!1}(a.menu,{text:'<span class="icon icon__burger"></span>',isCircle:!0,isMiddle:!0,isWhite:!0,onClick:function(){}}),function(e,i){var o=[];i.isNoLabelAnimated&&o.push("input-field__no-label-animated"),i.isSmall&&o.push("input-field__small"),i.isRounded&&o.push("input-field__rounded"),i.leftIcon&&o.push("input-field__has-left-icon");var a="";i.leftIcon&&(a='<div class=input-field_left-icon><div class="icon icon__'.concat(i.leftIcon,'"></div></div>'));var l='<div class="input-field '.concat(o.length?o.join(" "):"",'"><label><div ref=label>').concat(i.label,"</div><span></span></label> ").concat(a," <input type=text ref=input></div>"),d=n(l),r=t(d),c=!1;s(r.input,"focus",(function(){i.onFocus&&i.onFocus(r.input),d.classList.add("is-focus")})),s(r.input,"blur",(function(){i.onBlur&&i.onBlur(r.input),d.classList.remove("is-focus")})),s(r.input,"input",(function(e){c&&(c=!1,d.classList.remove("input-field__error"),r.label.textContent=i.label),i.onInput&&i.onInput(r.input,e);var n=""!=r.input.value;d.classList[n?"add":"remove"]("is-fill")})),s(r.input,"keydown",(function(e){13==e.which&&i.onEnter&&i.onEnter()})),e.appendChild(d);var u,p=!1}(a.search,{label:"Search",isRounded:!0,isSmall:!0,isNoLabelAnimated:!0,leftIcon:"search"}),e.appendChild(o),{showShadow:function(){o.classList.add("side_header__shadow")},hideShadow:function(){o.classList.remove("side_header__shadow")}}}function v(e,i){var o,a="<div class=scroll><div class=scroll_container ref=container><div class=scroll_content ref=content>".concat(i.innerHTML,"</div></div><div class=scroll_handler ref=handler><div></div></div></div>"),l=n(a),r=t(l),c=0,u=function(){r.handler.style.opacity=null},p=function(){_>=l.offsetHeight-17||(r.handler.style.opacity||(r.handler.style.opacity="1"),clearTimeout(o),o=setTimeout(u,2e3))},v=function(e,n){n?r.container.scrollTop=e:r.container.scrollTop+=e,r.container.scrollTop>0&&i.onHasScroll?i.onHasScroll():i.onHasNoScroll&&i.onHasNoScroll(),r.handler.style.top=Math.floor(8+r.container.scrollTop/r.container.scrollHeight*(l.offsetHeight-16+c))+"px",p()};s(l,"wheel",(function(e){var i=e.deltaY>0?1:-1;v(Math.floor(i*l.offsetHeight*.5))}));var h,f,_=0,m=function(e,i){var n=function(e,i){e=e||l.offsetHeight,i=i||r.container.scrollHeight;var n=Math.floor((e-16)*e/i),t=Math.floor(.1*(e-16)),s=Math.max(n,t,25);return c=n-s,s}(e,i);n!=_&&(_=n,r.handler.style.height=n+"px",n>=(e||l.offsetHeight)-17?(u(),r.handler.style.display="none"):(v(0),r.handler.style.display=null))};return s(l,"mouseenter",(function(){m()})),s(l,"mousemove",p),s(l,"mouseleave",u),s(r.handler,"mousedown",(function(e){h=e.y,f=r.container.scrollTop})),d("mousemove",(function(e){if(h){var i=e.y-h,n=Math.floor(f+r.container.scrollHeight*i/(l.offsetHeight-16+c));v(n,!0)}})),d("mouseup",(function(e){h=null})),e.appendChild(l),{content:r.content,scroll:v,update:m,hide:function(){r.handler.style.opacity=null}}}function h(e,i){var o=n("<div class=side_dialogs-list></div>"),a=(t(o),v(o,{innerHTML:"",onHasScroll:function(){i.headerComponent.showShadow()},onHasNoScroll:function(){i.headerComponent.hideShadow()}}));return e.appendChild(o),TGApp.onMtprotoInit((function(){MTProto.messages.getDialogs().then((function(e){console.log(e),e.dialogs.forEach((function(o,l){var d={};if(d.dialog=o,d.message=e.messages[l],"peerUser"==o.peer._?d.peer=e.users.find((function(e){return e.id==o.peer.user_id})):d.peer=e.chats.find((function(e){return e.id==o.peer.channel_id})),"peerChannel"==d.message.to_id._&&(d.author=e.users.find((function(e){return e.id==d.message.from_id}))),o.peer&&d.peer){d._peer=Object.assign({},o.peer),d._peer._="inputPeer"+d.peer._.charAt(0).toUpperCase()+d.peer._.substr(1),d._peer.access_hash=d.peer.access_hash;var r=function(e,i){var o=n('<div class=dialog><div class=dialog_photo><div class=dialog_photo-wrapper ref=photoWrapper></div><div class=dialog_online ref=online></div></div><div class=dialog_content><div class=dialog_header><div class=dialog_name ref=name></div><div class=dialog_message-status><div class="icon icon__sended"></div><div class="icon icon__readed"></div></div><div class=dialog_time ref=time></div></div><div class=dialog_info><div class=dialog_text ref=text></div><div class=dialog_status><div class=dialog_status-pinned><div class="icon icon__pinned"></div></div><div class=dialog_unreaded></div></div></div></div></div>'),a=t(o),l=e.peer.first_name||e.peer.title;e.peer.last_name&&(l+=" "+e.peer.last_name),a.name.textContent=l;var d=l.charAt(0);e.peer.last_name?d+=e.peer.last_name.charAt(0):l.split(" ").length>1?d+=l.split(" ")[1].charAt(0):d+=l.charAt(1),a.photoWrapper.textContent=d;var r,u=e.message.message;return e.message.media&&(u=e.message.media._.substr(12)),e.author&&(u="<span>".concat(e.author.first_name,":</span>Â ")+u),a.text.innerHTML=u,a.time.textContent=c(e.message.date),s(o,"click",(function(n){var t=o.getBoundingClientRect(),s=n.x-t.x,a=n.y-t.y,l=document.createElement("div");l.classList.add("button_wave"),l.style.top=a+"px",l.style.left=s+"px",o.appendChild(l),r&&r.classList.add("button_wave__hide"),r=l;var d=o.offsetWidth/2,c=(Math.abs(d-s)+d)/o.offsetWidth;setTimeout((function(){l.classList.add("button_wave__hide"),setTimeout((function(){o.removeChild(l)}),330)}),600*c),console.log(e),i.onClick&&i.onClick(e._peer)})),{dom:o}}(d,{onClick:i.onDialogSelected});d.component=r,a.content.appendChild(r.dom)}})),a.update(),i.onDialogsLoaded()}))})),{}}function f(e,i){var s=n("<div class=chat_wrapper style=display:none><div class=chat_header></div><div class=chat_messages ref=messages></div></div>"),o=v(t(s).messages,{innerHTML:""});return e.appendChild(s),MTProto.messages.getHistory(i.peer).then((function(e){var s=e.messages.reverse();s.forEach((function(e,i){var a=function(e,i){var s=n("<div class=message><div class=message_wrapper><div class=message_text ref=text></div><div class=message_time ref=time></div></div></div>"),o=t(s);return e.pFlags.out&&s.classList.add("message__out"),i&&i.from_id==e.from_id||s.classList.add("message__pip"),o.text.innerHTML=e.message||"&nbsp;",o.time.textContent=c(e.date),{dom:s}}(e,s[i+1]);o.content.appendChild(a.dom)})),i.onLoad()})),{show:function(){s.style.display=null,o.scroll(1e5,!0)},destroy:function(){e.removeChild(s)}}}var _=[];return e.AppComponent=function(e,i){var s=n("<div class=app><div ref=side></div><div class=flex-grow ref=main></div></div>"),o=t(s);!function(e,i){var s=n("<div class=side><div ref=header style=display:none></div><div ref=dialogs class=side_dialogs style=display:none></div></div>"),o=t(s),a=u(s,{isBig:!0,isBlue:!0}),l=p(o.header);h(o.dialogs,{headerComponent:l,onDialogsLoaded:function(){a.destroy().then((function(){o.header.style.display=null,o.dialogs.style.display=null}))},onDialogSelected:i.onDialogSelected}),e.appendChild(s)}(o.side,{onDialogSelected:function(e){a.openChat(e)}});var a=function(e,i){var s,o=n('<div class=main><div ref=chat class=chat></div><div class=main_placeholder ref=placeholder><div class=main_placeholder-icon><div class="icon icon__chats-placeholder"></div></div><div class=main_placeholder-title>Open Chat<br>or create a new one</div></div></div>'),a=t(o);return e.appendChild(o),{openChat:function(e){var i=u(o,{isBlue:!0,isBig:!0});a.placeholder.style.display="none",s&&s.destroy(),s=f(a.chat,{peer:e,onLoad:function(){i.destroy().then((function(){s.show()}))}})}}}(o.main);return e.appendChild(s),{}},e.mtprotoInited=function(){_.forEach((function(e){e()}))},e.onMtprotoInit=function(e){_.push(e)},e}({});
