var TGAuth=function(e){"use strict";var t,n=function(e){var t=document.createElement("div");return t.innerHTML=e,t.firstChild},i=function(e){var t={};return e.querySelectorAll("[ref]").forEach((function(e){t[e.getAttribute("ref")]=e})),t},o=function(e,t,n){e.addEventListener(t,n)},a=[],s=function(){a.forEach((function(e){e()}))};o(window,"resize",(function(){t&&clearTimeout(t),t=setTimeout(s,100)}));var d,l=function(e){a.push(e)},r=function(){a=[]},c=[],u=function(e,t){c.push({type:e,handler:t}),o(window,e,t)},h=function(){c.forEach((function(e){!function(e,t,n){e.removeEventListener(t,n)}(window,e.type,e.handler)})),c=[]},v=function(){var e={};return e.promise=new Promise((function(t,n){e.resolve=t,e.reject=n})),e};function f(e,t){var i=[];(t=t||{}).isBlue&&i.push("loader__blue"),t.isBig&&i.push("loader__big");var o='<svg class="loader '.concat(i.length?i.join(" "):"",'" viewBox="25 25 50 50"><circle cx=50 cy=50 r=20 stroke-miterlimit=10></circle></svg>'),a=n(o);return e.appendChild(a),{destroy:function(){var t=v();return a.classList.add("loader__hide"),setTimeout((function(){e.removeChild(a),t.resolve()}),300),t.promise}}}function p(e,t){var a=[];t.isBig&&a.push("button__big"),t.isBlock&&a.push("button__block"),t.isCircle&&a.push("button__circle"),t.isHidden&&a.push("is-hidden");var s,d='<button class="button '.concat(a.length?a.join(" "):"",'"><span ref=text>').concat(t.text,"</span></button>"),l=n(d),r=i(l),c=!1;o(l,"click",(function(e){if(!c){var n=l.getBoundingClientRect(),i=e.x-n.x,o=e.y-n.y,a=document.createElement("div");a.classList.add("button_wave"),a.style.top=o+"px",a.style.left=i+"px",t.isCircle&&(a.style.animationDuration="0.3s"),l.appendChild(a),s&&s.classList.add("button_wave__hide"),s=a;var d=l.offsetWidth/2,r=(Math.abs(d-i)+d)/l.offsetWidth;setTimeout((function(){a.classList.add("button_wave__hide"),setTimeout((function(){l.removeChild(a)}),330)}),Math.ceil((t.isCircle?300:600)*r)),t.onClick()}})),e.appendChild(l);var u,h=!1;return{dom:l,setLoading:function(e){h!=e&&(h=e,c=e,l.classList[e?"add":"remove"]("button__loading"),r.text.textContent=e?"Please wait...":t.text,e?u=f(l):(u.destroy(),u=null))}}}var m=function(e){(d=new EmojiConvertor).use_css_imgs=!0,d.use_sheet=!0,d.img_sets.apple.sheet=e?"img/emoji-flags.png":"img/emoji.png"};function g(e,t){var a,s="<div class=scroll><div class=scroll_container ref=container><div class=scroll_content ref=content>".concat(t.innerHTML,"</div></div><div class=scroll_handler ref=handler><div></div></div></div>"),d=n(s),l=i(d),r=0,c=function(){l.handler.style.opacity=null},h=function(){m>=d.offsetHeight-17||(l.handler.style.opacity||(l.handler.style.opacity="1"),clearTimeout(a),a=setTimeout(c,2e3))},v=function(e,t){t?l.container.scrollTop=e:l.container.scrollTop+=e,l.handler.style.top=Math.floor(8+l.container.scrollTop/l.container.scrollHeight*(d.offsetHeight-16+r))+"px",h()};o(d,"wheel",(function(e){var t=e.deltaY>0?1:-1;v(Math.floor(t*d.offsetHeight*.5))}));var f,p,m=0,g=function(e,t){var n=function(e,t){e=e||d.offsetHeight,t=t||l.container.scrollHeight;var n=Math.floor((e-16)*e/t),i=Math.floor(.1*(e-16)),o=Math.max(n,i,25);return r=n-o,o}(e,t);n!=m&&(m=n,l.handler.style.height=n+"px",n>=e-17?c():v(0))};return o(d,"mouseenter",(function(){g()})),o(d,"mousemove",h),o(d,"mouseleave",h),o(l.handler,"mousedown",(function(e){f=e.y,p=l.container.scrollTop})),u("mousemove",(function(e){if(f){var t=e.y-f,n=Math.floor(p+l.container.scrollHeight*t/(d.offsetHeight-16+r));v(n,!0)}})),u("mouseup",(function(e){f=null})),e.appendChild(d),{content:l.content,update:g,hide:function(){l.handler.style.opacity=null}}}function _(e,t){var a=n('<div class="auth-screen auth-animated show-down-screen"><div class=auth-header ref=header></div><div class=auth-title>Sign in to Telegram</div><div class=auth-info>Please confirm your country and<br>enter your phone number.</div><div class=auth-field ref=fieldCountry></div><div class=auth-field ref=fieldPhone></div><div class="auth-field auth-field__padded" ref=fieldCheckbox></div><div class="auth-field auth-field__button" ref=fieldButton></div></div>'),s=i(a);s.header.appendChild(TGInit.resources["logo.svg"]);var r,c=function(){if(h){b.setLoading(!0),f.setDisabled(!0),v.setDisabled(!0),_.setDisabled(!0);var e=f.getNumber();t.sendCode(e.plain).then((function(n){if(n.err){b.setLoading(!1),f.setDisabled(!1),v.setDisabled(!1),_.setDisabled(!1);var i="";return"AUTH_RESTART"==n.err&&(i="Send Code Error, try later"),"PHONE_NUMBER_INVALID"==n.err&&(i="Invalid Phone Number"),"PHONE_NUMBER_BANNED"==n.err&&(i="Phone Number Banned"),"SMS_CODE_CREATE_FAILED"==n.err&&(i="Send Code Error"),"PHONE_NUMBER_FLOOD"!=n.err&&"PHONE_PASSWORD_FLOOD"!=n.err||(i="You asked for the code too many times, try later"),void f.setError(i)}MTProto.initAllDc();var o=!_.getState();t.phoneEntered(e.plain,e.formatted,n.hash,n.codeLength,o)}))}},h=!1,v=function(e,t){m(!0);var a=TGInit.resources.countries,s="";a.forEach((function(e){var t=d.replace_colons(":flag-".concat(e.c,":"));"none"==e.c&&(t=""),s+='<div class="select-dropdown_option select-dropdown_option__country"><div>'.concat(t,"</div><div>").concat(e.n,"</div><div>").concat(e.p?"+"+e.p:"","</div></div>")}));var r=n('<div class=input-field><label><div ref=label>Country</div><span></span></label> <input type=text ref=input><div class=input-field_dropdown ref=drop><div class="icon icon__down"></div></div><div class=select-dropdown ref=dropdown></div></div>'),c=i(r),h=0,v=g(c.dropdown,{innerHTML:s}),f=!1,p=!1,_=function(e){r.classList.remove("is-focus"),c.dropdown.style.height=null,v.hide(),e&&p&&(c.input.value="",r.classList.remove("is-fill"),t.onSelect("")),p=!1,c.label.textContent="Country",f=!1};o(c.drop,"click",(function(){r.classList.contains("is-focus")?_(!0):c.input.focus()})),o(c.input,"focus",(function(){if(!f){r.classList.add("is-focus");for(var e=0,t=v.content.children.length;e<t;e++)v.content.children[e].style.display=null;var n=T(!0);v.update(n,56*v.content.children.length),f=!0}})),o(c.input,"input",(function(){p=!0,y=c.input.value;var e=""!=c.input.value;r.classList[e?"add":"remove"]("is-fill");for(var t=c.input.value.toLowerCase(),n=0,i=0,o=v.content.children.length;i<o;i++){var a=v.content.children[i],s=a.children[1].textContent.toLowerCase();s.includes(t)||"other"==s?(a.style.display=null,n++):a.style.display="none"}var d=T(!0);v.update(d,56*n)}));for(var b,y="",w=function(e){if(this!=b&&f){b=this,y=c.input.value;var t=this.children[1].textContent;y?c.input.value=t:c.label.textContent=t}},L=function(e){f&&(y?c.input.value=y:c.label.textContent="Country")},C=function(e){c.input.value=this.children[1].textContent,y="",_(),r.classList.add("is-fill"),t.onSelect(this.children[2].textContent)},E=0,x=v.content.children.length;E<x;E++)o(v.content.children[E],"mousemove",w),o(v.content.children[E],"mouseleave",L),o(v.content.children[E],"click",C);u("mousedown",(function(e){f&&!r.contains(e.target)&&_(!0)})),e.appendChild(r);var T=function(e){var t=document.documentElement.scrollHeight-(r.getBoundingClientRect().bottom+window.scrollY)-16,n=v.content.offsetHeight;return h=Math.min(375,t,n),!0===e&&(c.dropdown.style.height=h+"px"),h};setTimeout(T,1),l(T);var S=!1;return{setDisabled:function(e,t){S!=e&&(S=e,r.classList[e?"add":"remove"]("is-disabled"),e?c.input.setAttribute("disabled",!0):c.input.removeAttribute("disabled"))}}}(s.fieldCountry,{onSelect:function(e){f.setCode(e)}}),f=function(e,t){var a=n("<div class=input-field><label><div ref=label>Phone Number</div><span></span></label><div class=input-field_code ref=code></div><input type=text ref=input></div>"),s=i(a),d=!1,l="";o(s.input,"focus",(function(){a.classList.add("is-focus")})),o(s.input,"blur",(function(){a.classList.remove("is-focus")}));var r="",c=!1,u=function(e){var n=s.input.value,i=n.replace(/[^0-9.]/g,""),o=s.input.selectionStart,u=s.input.selectionEnd,h=l?15-(l.length-1):15,v=l?4:7;if(i.length>h&&!c)return s.input.value=r,e.data&&o--,e.data&&u--,void s.input.setSelectionRange(o,u);c&&(i=i.substr(0,h),o=u=99),c=!1;var f=i.match(/^(.{1})?(.{2})?(.{2})?(.{2})?(.{2})?(.{2})?(.{2})?(.{2})?(.*)?$/),p="";if(f){for(var m=1;m<=9;m++)f[m]&&(p+=" "+f[m]);p.length>1&&(p=p.substr(1))}else p=i;l||"+"!=n.charAt(0)||(p="+"+p),s.input.value=p,r=p,d&&(d=!1,a.classList.remove("input-field__error"),s.label.textContent="Phone Number"),e.data&&" "==p.substr(o-1,1)&&o++,e.data&&" "==p.substr(o-1,1)&&o++,s.input.setSelectionRange(o,o),n.replace(/[^0-9.]/g,"").length>=v?t.onValidPhone():t.onInvalidPhone();var g=""!=s.input.value;a.classList[g||l?"add":"remove"]("is-fill")};o(s.input,"input",u),o(s.input,"keydown",(function(e){13==e.which&&t.onEnter()})),e.appendChild(a);var h=!1;return{setError:function(e){d=!0,a.classList.add("input-field__error"),s.label.textContent=e},setDisabled:function(e,t){h!=e&&(h=e,a.classList[e?"add":"remove"]("is-disabled"),e?s.input.setAttribute("disabled",!0):s.input.removeAttribute("disabled"))},setCode:function(e){l=e,s.code.textContent=l?e+" ":"",c=!0,u({data:null}),s.input.focus()},getNumber:function(){var e="";l&&(e+=l.substr(1)),e+=s.input.value.replace(/[^0-9.]/g,"");var t="";return l&&(t+=l+" "),"+"!=(t+=s.input.value).charAt(0)&&(t="+"+t),{plain:e,formatted:t}}}}(s.fieldPhone,{onValidPhone:function(){h||(h=!0,clearTimeout(r),b.dom.classList.remove("is-hidden"),b.dom.classList.remove("hide-up"),b.dom.classList.add("show-down"))},onInvalidPhone:function(){h&&(h=!1,b.dom.classList.remove("show-down"),b.dom.classList.add("hide-up"),r=setTimeout((function(){b.dom.classList.add("is-hidden")}),330))},onEnter:c}),_=function(e,t){var o="<label class=checkbox><input type=checkbox ".concat((t=t||{}).checked?" checked":""," ref=input> <span>Keep me signed in</span></label>"),a=n(o),s=i(a);e.appendChild(a);var d=!1;return{getState:function(){return!!s.input.checked},setDisabled:function(e){d!=e&&(d=e,a.classList[e?"add":"remove"]("is-disabled"),e?s.input.setAttribute("disabled",!0):s.input.removeAttribute("disabled"))}}}(s.fieldCheckbox,{checked:!0}),b=p(s.fieldButton,{text:"Next",isBig:!0,isBlock:!0,isHidden:!0,onClick:c});return e.appendChild(a),{hide:function(){a.classList.add("auth-animated__hide-left")},show:function(){b.setLoading(!1),f.setDisabled(!1),v.setDisabled(!1),_.setDisabled(!1),a.classList.remove("auth-animated__hide-left")}}}function b(e,t){var a="<div class=input-field><label><div ref=label>".concat(t.label,"</div><span></span></label> <input type=text ref=input></div>"),s=n(a),d=i(s),l=!1;o(d.input,"focus",(function(){t.onFocus&&t.onFocus(d.input),s.classList.add("is-focus")})),o(d.input,"blur",(function(){t.onBlur&&t.onBlur(d.input),s.classList.remove("is-focus")})),o(d.input,"input",(function(e){l&&(l=!1,s.classList.remove("input-field__error"),d.label.textContent=t.label),t.onInput&&t.onInput(d.input,e);var n=""!=d.input.value;s.classList[n?"add":"remove"]("is-fill")})),o(d.input,"keydown",(function(e){13==e.which&&t.onEnter&&t.onEnter()})),e.appendChild(s);var r,c=!1;return{refs:d,setError:function(e){l=!0,s.classList.add("input-field__error"),d.label.textContent=e},setDisabled:function(e,t){c!=e&&(c=e,s.classList[e?"add":"remove"]("is-disabled"),e?d.input.setAttribute("disabled",!0):d.input.removeAttribute("disabled"),t&&(r=f(s,{isBlue:!0})),!e&&r&&(r.destroy(),r=null))}}}function y(e,t){var a,s,d,l=n('<div class="auth-screen auth-animated auth-animated__hide-right"><div class="auth-header auth-header__anim" ref=header></div><div class=auth-animated-wrapper><div class=auth-animated ref=formCode><div class=auth-title><span ref=phone></span> <span class="icon icon__edit" ref=edit></span></div><div class=auth-info>We have sent you an SMS<br>with the code.</div><div class=auth-field ref=authFieldCode></div></div><div class="auth-animated auth-animated__hide-right" ref=formPassword><div class=auth-title>Enter a Password</div><div class=auth-info>Your account is protected with<br>an additional password.</div><div class=auth-field ref=authFieldPassword></div><div class="auth-field auth-field__button" ref=authFieldPasswordButton></div></div></div></div>'),r=i(l),c=!1,u=function(e){alert("2FA not implemented")},h=lottie.loadAnimation({container:r.header,renderer:"svg",loop:!0,autoplay:!1,animationData:TGInit.resources.idle}),v=function(e){h.renderer.elements[2].shapes.forEach((function(t){t._isAnimated=e})),h.renderer.elements[3].shapes.forEach((function(t){t._isAnimated=e}))},m=lottie.loadAnimation({container:r.header,renderer:"svg",loop:!1,autoplay:!1,animationData:TGInit.resources.tracking});m.hide();var g=lottie.loadAnimation({container:r.header,renderer:"svg",loop:!1,autoplay:!1,animationData:TGInit.resources["close-toggle"]});g.playSegments([48,49],!0),g.renderer.elements[8].shapes.forEach((function(e){e._isAnimated=!1})),g.hide();var _=lottie.loadAnimation({container:r.header,renderer:"svg",loop:!1,autoplay:!1,animationData:TGInit.resources["close-peek-show"]});_.hide();var y=lottie.loadAnimation({container:r.header,renderer:"svg",loop:!1,autoplay:!1,animationData:TGInit.resources["close-peek-hide"]});y.hide();var w,L,C,E,x,T,S=lottie.loadAnimation({container:r.header,renderer:"svg",loop:!1,autoplay:!1,animationData:TGInit.resources["close-to-peek"]});S.hide();var A,I,P=function(e){w&&(w(),w=null),L&&(L(),L=null),v(!1),h.loop=!1,h.setSpeed(3),h.currentFrame<90?h.playSegments([h.currentFrame,20],!0):h.playSegments([h.currentFrame,170],!0),C=h.addEventListener("complete",(function(){C(),C=null,v(!0),h.hide(),e()}))},D=function(){h.loop=!0,h.setSpeed(1),h.playSegments([0,180],!0),h.show()},k=b(r.authFieldCode,{label:"Code",onFocus:function(e){P((function(){m.show(),m.setSpeed(1),m.playSegments([0,20],!0),E=m.addEventListener("complete",(function(){E(),E=null,m.setSpeed(4),m.playSegments([20,20+e.value.length*(140/36)],!0),x=m.addEventListener("complete",(function(){x(),x=null,m.setSpeed(1)}))}))}))},onBlur:function(e){C&&(C(),C=null),E&&(E(),E=null),x&&(x(),x=null),m.setSpeed(4),m.playSegments([20+e.value.length*(140/36),20],!0),L=m.addEventListener("complete",(function(){L(),L=null,m.setSpeed(1),m.playSegments([20,0],!0),w=m.addEventListener("complete",(function(){w(),w=null,m.hide(),D()}))}))},onInput:(A="",function(e,n){var i=e.selectionStart,o=e.selectionEnd;if(!new RegExp("^\\d{0,".concat(d,"}$")).test(e.value))return e.value=A,n.data&&i--,n.data&&o--,void e.setSelectionRange(i,o);var l,u=20+A.length*(140/36),h=20+e.value.length*(140/36);m.playSegments([u,h],!0),A=e.value,e.value.length==d&&(l=e.value,k.setDisabled(!0,!0),r.edit.classList.add("is-cursor-not-allowed"),c=!0,MTProto.auth.signIn(a,s,l).then((function(e){if(e.err){k.setDisabled(!1),r.edit.classList.remove("is-cursor-not-allowed"),c=!1;var n="";return"PHONE_CODE_INVALID"==e.err&&(n="Invalid Code"),"PHONE_CODE_EXPIRED"==e.err&&(n="Code Expired, try Resend"),void k.setError(n)}"pass"==e.next&&(r.formCode.classList.add("auth-animated__hide-left"),r.formPassword.classList.remove("auth-animated__hide-right"),H.refs.input.focus()),"reg"==e.next&&(r.formPassword.classList.remove("auth-animated__hide-right"),t.showRegScreen(e.termOfService)),"done"==e.next&&t.onAuth()})))})});o(r.edit,"click",(function(){c||t.showPhoneScreen()}));var M,B=!1,N=!1,F=!1,H=function(e,t){var a,s=n('<div class=input-field><label><div ref=label>Password</div><span></span></label> <input type=password ref=input><div class=input-field_password ref=toggle><div class="icon icon__eye-show" ref=toggleIcon></div></div></div>'),d=i(s),l=!1,r=!1,c=!1;o(d.toggle,"click",(function(){h||((r=!r)?(d.toggleIcon.classList.remove("icon__eye-show"),d.toggleIcon.classList.add("icon__eye-hide"),d.input.setAttribute("type","text")):(d.toggleIcon.classList.add("icon__eye-show"),d.toggleIcon.classList.remove("icon__eye-hide"),d.input.setAttribute("type","password")),t.onToggle(r),c&&d.input.focus())})),o(d.input,"focus",(function(){c=!0,clearTimeout(a),t.onFocus&&t.onFocus(d.input),s.classList.add("is-focus")})),o(d.input,"blur",(function(){t.onBlur&&t.onBlur(d.input),s.classList.remove("is-focus"),a=setTimeout((function(){c=!1}),150)})),o(d.input,"input",(function(e){l&&(l=!1,s.classList.remove("input-field__error"),d.label.textContent="Password"),t.onInput&&t.onInput(d.input,e);var n=""!=d.input.value;s.classList[n?"add":"remove"]("is-fill")})),o(d.input,"keydown",(function(e){13==e.which&&t.onEnter()})),e.appendChild(s);var u,h=!1;return{refs:d,setError:function(e){l=!0,s.classList.add("input-field__error"),d.label.textContent=e},setDisabled:function(e,t){h!=e&&(h=e,s.classList[e?"add":"remove"]("is-disabled"),e?d.input.setAttribute("disabled",!0):d.input.removeAttribute("disabled"),t&&(u=f(s,{isBlue:!0})),!e&&u&&(u.destroy(),u=null))}}}(r.authFieldPassword,{onFocus:function(e){clearTimeout(M),F=!0,N?N=!1:P((function(){B?(_.show(),_.playSegments([0,33],!0)):(g.show(),g.playSegments([0,49],!0))}))},onBlur:function(e){M=setTimeout((function(){var e;(F=!1,N)||(B?(_.hide(),y.show(),y.playSegments([0,33],!0),e=y):(g.playSegments([49,98],!0),e=g),w=e.addEventListener("complete",(function(){w(),w=null,g.hide(),y.hide(),D()})))}),150)},onInput:function(e){e.value.length?(clearTimeout(I),R.dom.classList.remove("is-hidden"),R.dom.classList.remove("hide-up"),R.dom.classList.add("show-down")):(R.dom.classList.remove("show-down"),R.dom.classList.add("hide-up"),I=setTimeout((function(){R.dom.classList.add("is-hidden")}),330))},onEnter:function(){u(H.refs.input.value)},onToggle:function(e){if(T&&(T(),T=null),B=e,F){N=!0,_.hide(),g.hide(),S.show();var t=[0,16];e||(t=[16,33]),S.playSegments(t,!0),T=S.addEventListener("complete",(function(){T(),T=null,S.hide(),B?(_.show(),_.playSegments([32,33],!0)):(g.show(),_.currentFrame=48)}))}}}),R=p(r.authFieldPasswordButton,{text:"Next",isBig:!0,isBlock:!0,isHidden:!0,onClick:function(){u(H.refs.input.value)}});return e.appendChild(l),{setPhone:function(e,t,n,i){r.phone.textContent=t,a=e,s=n,d=i},hide:function(e){l.classList.add(e?"auth-animated__hide-left":"auth-animated__hide-right")},show:function(){h.play(),l.classList.remove("auth-animated__hide-left"),l.classList.remove("auth-animated__hide-right"),k.refs.input.focus()}}}function w(e,t){var a,s=n('<div class="auth-screen auth-animated auth-animated__hide-right"><div class=auth-header ref=header><label class=auth-photo ref=photo><div class="auth-photo_overlay auth-photo_overlay__hide" ref=photoOverlay></div><div class="icon icon__add-photo"></div><input type=file ref=file accept=image/jpeg,image/png></label></div><div class=auth-title>Your Name</div><div class=auth-info>Enter your name and add<br>a profile picture</div><div class=auth-field ref=fieldFirst></div><div class=auth-field ref=fieldLast></div><div class="auth-field auth-field__button" ref=fieldButton></div></div>'),d=i(s),l=n('<div class=auth-photo-modal><div class=auth-photo-modal_overlay ref=overlay></div><div class=auth-photo-modal_content ref=content><div class=auth-photo-modal_close ref=close><div class="icon icon__close"></div></div><div class=auth-photo-modal_header>Drag to Reposition</div><div class=auth-photo-modal_button ref=button></div><div class=auth-photo-modal_body><canvas ref=canvasImage width=720 height=720></canvas><canvas ref=canvasCircle width=360 height=360></canvas></div></div></div>'),r=i(l),c="",h=(p(r.button,{text:'<span class="icon icon__check"></span>',isCircle:!0,onClick:function(){var e=r.canvasImage.getContext("2d").getImageData(40,40,640,640),t=document.createElement("canvas");t.width=640,t.height=640,t.getContext("2d").putImageData(e,0,0),c=t.toDataURL("image/jpeg"),a&&d.photo.removeChild(a),(a=document.createElement("img")).src=c,d.photo.insertBefore(a,d.photo.firstChild),d.photoOverlay.classList.remove("auth-photo_overlay__hide"),h()}}),function(){r.content.classList.add("hide-down"),r.overlay.classList.add("auth-photo-modal_overlay__hide"),setTimeout((function(){l.classList.remove("auth-photo-modal__active"),r.content.classList.remove("hide-down"),r.overlay.classList.remove("auth-photo-modal_overlay__hide")}),300)});o(r.close,"click",h),document.body.appendChild(l);var v=r.canvasCircle.getContext("2d");v.clearRect(0,0,360,360),v.fillStyle="rgba(255,255,255,0.5)",v.beginPath(),v.arc(180,180,160,0,2*Math.PI),v.rect(360,0,-360,360),v.fill();var f,m,g,_,y,w,L,C,E,x,T,S="auto",A=0,I=0,P=!1,D=0,k=function(e,t){var n,i=e-180,o=t-180;if(Math.sqrt(i*i+o*o)<160)n="move";else{var a=180*Math.atan2(t-180,e-180)/Math.PI;n=a>=0?a<23?"e-resize":a<68?"se-resize":a<113?"s-resize":a<158?"sw-resize":"w-resize":a>-22?"e-resize":a>-67?"ne-resize":a>-112?"n-resize":a>-157?"nw-resize":"w-resize"}n!=S&&(S=n,document.body.style.cursor=S)};o(r.canvasCircle,"mousedown",(function(e){M=r.canvasCircle.getBoundingClientRect(),P=!0,A=e.layerX,I=e.layerY;var t=A-180,n=A-180;D=Math.sqrt(t*t+n*n),k(A,I),document.body.classList.add("no-user-select"),f="move"==S?"move":"resize"})),u("mouseup",(function(){P=!1,E=L,x=C,y=g,w=_,S="auto",document.body.style.cursor=null,document.body.classList.remove("no-user-select")}));var M,B=function(){var e=r.canvasImage.getContext("2d");e.clearRect(0,0,720,720),e.drawImage(m,L,C,g,_)};u("mousemove",(function(e){if(P){var t=e.x-M.x,n=e.y-M.y,i=720*(t-A)/360,o=720*(n-I)/360;if("resize"==f){var a,s=180*Math.atan2(n-180,t-180)/Math.PI;(a=s>=0?s<23?"e-resize":s<68?"se-resize":s<113?"s-resize":s<158?"sw-resize":"w-resize":s>-22?"e-resize":s>-67?"ne-resize":s>-112?"n-resize":s>-157?"nw-resize":"w-resize")!=S&&(S=a,document.body.style.cursor=S)}if("move"==S)(L=E+i)>0&&(L=0),L+g<720&&(L=720-g),(C=x+o)>0&&(C=0),C+_<720&&(C=720-_);else{var d=t-180,l=n-180,r=Math.sqrt(d*d+l*l)/D;_=w*r,(g=y*r)<720&&(_=(g=720)/T),_<720&&(g=(_=720)*T),(L=E-(g-y)/2)>0&&(L=0),(C=x-(_-w)/2)>0&&(C=0),L+g<720&&(L=720-g),C+_<720&&(C=720-_)}B()}})),o(r.canvasCircle,"mousemove",(function(e){P||k(e.layerX,e.layerY)})),o(r.canvasCircle,"mouseleave",(function(e){P||(S="auto",document.body.style.cursor=null)})),o(d.file,"change",(function(){var e=new FileReader;e.readAsDataURL(d.file.files[0]),e.onloadend=function(){d.file.value="",l.classList.add("auth-photo-modal__active"),r.content.classList.add("show-down"),(m=new Image).onload=function(){var e=m.naturalWidth,t=m.naturalHeight;T=e/t,g=720,_=720*t/e,t<e&&(_=720,g=720*e/t),L=0,C=(720-_)/2,t<e&&(C=0,L=(720-g)/2),E=L,x=C,y=g,w=_,B()},m.setAttribute("src",e.result)}}));var N,F=function(){if(H){O.setLoading(!0),R.setDisabled(!0),z.setDisabled(!0);var e=t.getPhone();MTProto.auth.signUp(e.plain,e.hash,R.refs.input.value,z.refs.input.value).then((function(e){if(e.err)return O.setLoading(!1),R.setDisabled(!1),z.setDisabled(!1),"FIRSTNAME_INVALID"==e.err&&R.setError("Name Invalid"),"PHONE_CODE_EXPIRED"==e.err&&R.setError("Confirm Code Expired, try again"),void("LASTNAME_INVALID"==e.err&&R.setError("Last Name Invalid"));if("done"==e.next)if(c){for(var n=c.split(","),i=n[0].match(/:(.*?);/)[1],o=atob(n[1]),a=o.length,s=new Uint8Array(a);a--;)s[a]=o.charCodeAt(a);var d=new File([s],"profile.jpg",{type:i});MTProto.utils.uploadFile(d).then((function(e){return MTProto.utils.uploadProfilePhoto(e)})).then((function(e){t.onAuth()}))}else t.onAuth()}))}},H=!1,R=b(d.fieldFirst,{label:"Name",onEnter:F,onInput:function(e){e.value.length?H||(H=!0,clearTimeout(N),O.dom.classList.remove("is-hidden"),O.dom.classList.remove("hide-up"),O.dom.classList.add("show-down")):H&&(H=!1,O.dom.classList.remove("show-down"),O.dom.classList.add("hide-up"),N=setTimeout((function(){O.dom.classList.add("is-hidden")}),330))}}),z=b(d.fieldLast,{label:"Last Name (optional)",onEnter:F}),O=p(d.fieldButton,{text:"Start messaging",isBig:!0,isBlock:!0,isHidden:!0,onClick:F});return e.appendChild(s),{destroyModal:function(){document.body.removeChild(l)},show:function(e){if(s.classList.remove("auth-animated__hide-right"),e){var t='<div class=auth-photo-modal><div class=auth-photo-modal_overlay ref=overlay></div><div class=auth-photo-modal_content ref=content><div class=auth-photo-modal_header>Terms of Service</div><div class=auth-photo-modal_button ref=button></div><div class="auth-photo-modal_body auth-photo-modal_body__terms">'.concat(e,"</div></div></div>"),o=n(t),a=i(o);p(a.button,{text:'<span class="icon icon__check"></span>',isCircle:!0,onClick:function(){a.content.classList.add("hide-down"),a.overlay.classList.add("auth-photo-modal_overlay__hide"),setTimeout((function(){document.body.removeChild(o)}),300)}}),document.body.appendChild(o),o.classList.add("auth-photo-modal__active"),a.content.classList.add("show-down")}}}}return e.AuthComponent=function(e){var t,i,o,a,s,d,l,c=n("<div class=auth></div>"),u=!1,f=!1,p=!1,m=function(){l.hide(),C.show()},g=function(e){l.hide(!0),E.show(e)},b=function(){MTProto.auth.sendCode(s).then((function(e){d.resolve(e)}))},L=function(){c.classList.add("hide-down"),E.destroyModal(),r(),h(),setTimeout((function(){e.removeChild(c),TGInit.initApp()}),300)},C=_(c,{phoneEntered:function(e,n,s,d,r){t=e,i=n,o=s,a=d,TGInit.changeStorageType(r),C.hide(),l.setPhone(t,i,o,a),l.show()},sendCode:function(e){return d=v(),u=!0,s=e,f&&p&&b(),d.promise}}),E=w(c,{onAuth:L,getPhone:function(){return{plain:t,hash:o}}});return e.appendChild(c),{mtprotoInited:function(){f=!0,u&&p&&b()},codeScreenLoaded:function(){p=!0,l=y(c,{showPhoneScreen:m,showRegScreen:g,onAuth:L}),u&&f&&b()}}},e}({});
