var tgMain=function(e){"use strict";const t=()=>{const e={};return e.promise=new Promise((t,o)=>{e.resolve=t,e.reject=o}),e},o="#testmode"==location.hash;let n=sessionStorage.storage||"localStorage";sessionStorage.storage=n;const s=e=>window[n][e];let a=0,r={};const i=new Worker("js/worker.min.js");i.onmessage=e=>{const t=e.data.id;r[t].resolve(e.data.result),delete r[t]};const d=(e,o)=>{const n=a++;i.postMessage({id:n,method:e,params:o});const s=t();return r[n]=s,s.promise},c={main:{},auth:{},app:{}},l=e=>new Promise(t=>{const o=document.createElement("link");o.setAttribute("rel","stylesheet"),o.setAttribute("href",`css/${e}.min.css`);const n=setInterval(()=>{try{o.sheet&&o.sheet.cssRules.length&&(clearInterval(n),c[e].style=o,t())}catch(e){}},10);document.head.appendChild(o)}),m=e=>{const t=c[e]?e:"main";if(!c[t][e])return new Promise(o=>{const n=document.createElement("script");n.src=`js/${e}.min.js`,n.onload=()=>{c[t][e]=n,o()},document.head.appendChild(n)})},u=e=>{for(let t in e){const o=e[t];"LINK"!=o.tagName&&"SCRIPT"!=o.tagName||document.head.removeChild(o),delete e[t]}};let p,g;const h=()=>{const e=document.createElement("div");e.innerHTML='<svg class="loader loader__big loader__blue" viewBox="25 25 50 50">\n      <circle cx="50" cy="50" r="20">\n    </svg>',g=setTimeout(()=>{p=e.firstChild,document.body.appendChild(p)},500)},w=()=>new Promise(e=>{clearTimeout(g),p?(p.classList.add("loader__hide"),setTimeout(()=>{e()},150),setTimeout(()=>{document.body.removeChild(p),p=null},300)):e()});let y,v,f=!1,b=!1;const P=()=>{if(b)return v.promise;b=!0,v=t();let e=document.createElement("div");e.className="messages-bg__default m-preloader",e.innerHTML="a<b>a</b>",document.body.appendChild(e);const o=[l("app"),m("app"),m("proto"),document.fonts.ready];return document.fonts.check("1rem icons")||o.push(document.fonts.load("1rem icons")),Promise.all(o).then(()=>{document.body.removeChild(e),v.resolve()}),v.promise},T=()=>{if(f)return y.promise;f=!0,y=t();let e=document.createElement("div");e.className="a-flag m-preloader",e.innerHTML="a<b>a</b>",document.body.appendChild(e);const o=[new Promise(e=>{const t=new Image;t.onload=()=>{c.auth.logo=t,e()},t.src="img/logo.svg"}),l("auth"),m("auth"),m("proto"),document.fonts.ready];return document.fonts.check("1rem icons-auth")||o.push(document.fonts.load("1rem icons-auth")),Promise.all(o).then(()=>{document.body.removeChild(e),y.resolve()}),y.promise},A=async()=>{h(),u(c.auth),f=!1,await P(),await w(),tgApp.init(),await tgProto.init(),tgApp.protoInited(),await m("lottie"),tgApp.lottieLoaded()},S=async()=>{h(),u(c.app),b=!1,await T(),await w();const e=tgAuth.init();var t;await tgProto.init(),tgProto.initAllDc(),e.protoInited(),await(t=1200,new Promise(e=>{setTimeout(e,t)})),await Promise.all([m("lottie"),new Promise(e=>{const t=new XMLHttpRequest;t.open("GET","img/monkey.tgs",!0),t.responseType="arraybuffer",t.onload=async()=>{const o=JSON.parse((new TextDecoder).decode(await d("gunzip",new Uint8Array(t.response))));c.auth.monkey=o,e()},t.send()})]),e.lottieLoaded()};return s("user_id")?A():S(),e.callWorker=d,e.changeStorageType=e=>{const t=e?"sessionStorage":"localStorage";t!=n&&(sessionStorage.storage=t,Object.keys(window[n]).forEach(e=>{"storage"!=e&&(window[t][e]=window[n][e])}),window[n].clear(),n=t,sessionStorage.storage=n)},e.getStorage=s,e.initApp=A,e.initAuth=S,e.isTestMode=o,e.loadApp=P,e.loadAuth=T,e.resources=c,e.setStorage=(e,t)=>{null===t?delete window[n][e]:window[n][e]=t},e}({});
